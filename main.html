<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refined Futuristic Travel Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Reset and General Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        html {
            scroll-behavior: smooth;
        }

        /* --- Preloader --- */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a18;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }

        #preloader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-top-color: #4fd1ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }


        /* Wrapper for Animated Background */
        #background-wrapper {
            width: 100%;
            height: 100vh;
            background: linear-gradient(300deg, #0a0a18, #1a1a38, #0a0a18, #2a1a38);
            background-size: 400% 400%;
            animation: gradientBG 25s ease infinite;
            position: relative; /* For APOD overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1200px; /* Enhanced perspective */
            overflow: hidden; /* Hide overflowing elements */
        }

        #apod-background-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0; /* Start hidden */
            transition: opacity 1.5s ease-in-out 0.5s; /* Added delay */
            z-index: 0; /* Behind container */
            pointer-events: none; /* Prevent interaction */
        }
         #apod-background-overlay.visible {
            opacity: 0.15; /* Subtle overlay */
         }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body {
            overflow: hidden;
            height: 100vh;
            margin: 0;
            padding: 0;
            background-color: #0a0a18; /* Fallback */
        }

        /* Container Styles */
        .container {
            position: relative;
            width: 90vw;
            max-width: 1200px;
            height: 85vh; /* Slightly taller */
            background: rgba(15, 15, 25, 0.6); /* More transparent */
            border-radius: 25px; /* Smoother radius */
            box-shadow: 0 25px 80px rgba(0, 0, 100, 0.2),
                        0 15px 40px rgba(0, 0, 0, 0.4),
                        0 0 150px rgba(78, 78, 255, 0.25);
            overflow: hidden;
            backdrop-filter: blur(12px); /* Increased blur */
            border: 1px solid rgba(255, 255, 255, 0.15);
            transform-style: preserve-3d;
            transform: rotateX(5deg) rotateY(0deg) scale(1); /* Initial tilt & scale */
            transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            z-index: 2;
        }

        /* Particle Background */
        #particles {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 1; /* Above gradient, below container elements */
            pointer-events: none;
        }
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255,255,255,0.7);
            border-radius: 50%;
            opacity: 0; /* Start invisible */
            animation: twinkle 4s infinite alternate;
        }
        @keyframes twinkle {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 0.8; transform: scale(1); }
            100% { opacity: 0.3; transform: scale(0.8); }
        }

        /* Title Styles */
        .title {
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%) translateZ(50px); /* Add depth */
            font-size: 26px;
            color: #fff;
            z-index: 10;
            text-transform: uppercase;
            letter-spacing: 4px;
            font-weight: 300;
            text-shadow: 0 0 15px rgba(79, 150, 253, 0.8);
            animation: glow 2.5s ease-in-out infinite alternate;
            pointer-events: none; /* Prevent title blocking interactions */
        }

        @keyframes glow {
            0% { text-shadow: 0 0 15px rgba(79, 150, 253, 0.7); }
            100% { text-shadow: 0 0 25px rgba(79, 209, 253, 1), 0 0 50px rgba(79, 109, 253, 0.6); }
        }

        /* Container Pseudo-element for subtle inner glow */
        .container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(79, 109, 253, 0.08) 0%, rgba(13, 13, 39, 0) 65%);
            z-index: 0;
            animation: pulse 12s infinite alternate ease-in-out;
            pointer-events: none;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.4; }
            100% { transform: scale(1.15); opacity: 0.8; }
        }

        /* Slide Styles */
        .slide {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
        }

        /* Item Styles */
        .slide .item {
            position: absolute;
            width: 340px; /* Card width */
            height: 480px; /* Card height */
            top: 50%; /* Center vertically */
            left: 50%; /* Center horizontally for transform origin */
            border-radius: 20px;
            background-position: center;
            background-size: cover;
            /* Refined transition for transform, opacity, filter */
            transition: transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        opacity 0.6s ease-out,
                        filter 0.7s ease;
            overflow: hidden;
            transform-style: preserve-3d;
            opacity: 0; /* Start hidden */
            filter: brightness(0.5); /* Start dimmed */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            /* Hint browser optimization */
            will-change: transform, opacity;
            cursor: pointer; /* Indicate cards can be clicked */
            transform: translate(-50%, -50%); /* Base centering transform */
        }

         /* Remove cursor for the main content display item */
         .slide .item.main-display {
             cursor: default;
         }
          /* Add cursor for the first visible side card */
         .slide .item.is-right-1 {
             cursor: pointer;
         }


        /* Item specific states (set by JS) */
        .item.is-center {
            opacity: 1;
            filter: brightness(1);
            z-index: 2;
            cursor: default; /* No click action on center */
        }
        .item.is-right-1 {
            opacity: 1;
            filter: brightness(0.75);
            z-index: 1;
        }
        .item.is-right-2 {
            opacity: 1;
            filter: brightness(0.6);
            z-index: 0;
        }
         .item.is-hidden-left, .item.is-hidden-right {
            opacity: 0;
            filter: brightness(0.5);
            z-index: -1;
             pointer-events: none; /* Prevent interaction when hidden */
        }

        /* Style for the full background items */
        .slide .item.full-background {
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            opacity: 1;
            /* Adjust transform slightly to place behind cards */
            transform: translate3d(0, 0, -50px);
            transition: background-image 0.8s ease-in-out, opacity 0.5s ease, transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border: none;
            box-shadow: none;
            cursor: default;
             pointer-events: none; /* Ensure BG doesn't block clicks */
        }
        .slide .item.full-background.main-display {
            z-index: 1; /* Above preview */
            opacity: 1;
            transform: translate3d(0, 0, -20px);
        }
         .slide .item.full-background.background-preview {
            z-index: 0; /* Below main display */
            opacity: 0.7;
            transform: translate3d(0, 0, -50px);
         }

        /* Item Pseudo-elements for Gradient Overlays */
        .slide .item::before { /* Bottom Dark Fade */
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60%;
            background: linear-gradient(to top, rgba(0,0,0,0.85), transparent);
            z-index: 5;
            pointer-events: none;
            border-radius: 0 0 20px 20px;
            transition: opacity 0.3s ease; /* Fade overlay slightly on hover */
        }
        .slide .item::after { /* Subtle Top Fade */
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 20%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.2), transparent);
            z-index: 5;
             pointer-events: none;
             border-radius: 20px 20px 0 0;
        }
         /* Disable overlays for background items */
        .slide .item.full-background::before,
        .slide .item.full-background::after {
            display: none;
        }
         .slide .item:hover::before {
             opacity: 0.8;
         }

        /* Content Styles */
        .item .content {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 35px;
            color: #fff;
            z-index: 10;
            opacity: 0;
             /* Base state for transform - JS adds Z */
             transform: translateY(40px);
             /* Apply parallax transition here */
             transition: opacity 0.7s ease-out 0.6s,
                         transform 0.7s ease-out 0.6s,
                         /* Add transition for text parallax */
                         transform 0.3s cubic-bezier(0.23, 1, 0.32, 1);
             transform-style: preserve-3d;
             pointer-events: none; /* Allow clicks to pass through content to item */
        }
        /* Ensure content becomes visible */
        .slide .item.main-display.active-content .content {
             opacity: 1;
             transform: translateY(0) translateZ(30px); /* Bring content forward */
             pointer-events: auto; /* Enable interaction on visible content */
        }

        /* Location Info Styles */
        .content .location-info {
            display: flex;
            align-items: center;
            margin-bottom: 18px;
            font-size: 14px;
             opacity: 0.8;
        }
        .content .location-info i {
            margin-right: 10px;
            font-size: 16px;
            color: #4fd1ff;
            animation: bounce 2.5s infinite ease-in-out;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        /* Name Styles */
        .content .name {
            font-size: 40px;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 0 3px 15px rgba(0,0,0,0.6);
            position: relative;
            line-height: 1.1;
             transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1); /* For parallax */
        }
        .content .name::after { /* Underline effect */
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 0;
            height: 3px;
            background: #4fd1ff;
            box-shadow: 0 0 12px #4fd1ff;
            transition: width 0.8s ease-out 0.8s; /* Delay expansion */
        }
        .slide .item.main-display.active-content .content .name::after {
             width: 60px; /* Animate width in */
        }


        /* Description Styles */
        .content .des {
            margin: 20px 0;
            font-size: 15px;
            font-weight: 300;
            line-height: 1.6em;
            max-width: 90%; /* Limit width slightly */
            text-shadow: 0 1px 6px rgba(0,0,0,0.8);
             opacity: 0.9;
              transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1); /* For parallax */
        }

        /* Button Group Styles */
        .content .button-group {
            display: flex;
            gap: 18px;
            margin-top: 25px;
             pointer-events: auto; /* Ensure buttons are clickable */
             transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1); /* For parallax */
        }

        /* General Button Styles */
        .content button, .nav-buttons button {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            outline: none; /* Remove default */
            text-transform: uppercase;
             letter-spacing: 0.5px;
             background-clip: padding-box; /* Fix potential border issues */
        }
        /* Focus state for accessibility */
        .content button:focus-visible,
        .nav-buttons button:focus-visible,
        .pagination button:focus-visible,
        #closeModal:focus-visible,
        .gallery-nav button:focus-visible {
             box-shadow: 0 0 0 3px rgba(79, 209, 255, 0.7) !important; /* Ensure visibility */
             outline: 2px solid transparent; /* Hide default, use shadow */
             border-radius: 50px; /* Maintain shape */
        }
        #closeModal:focus-visible, .gallery-nav button:focus-visible {
             border-radius: 50%;
        }
        .pagination button:focus-visible {
             border-radius: 50%;
        }


        /* Explore Button Styles */
        .content .explore-btn {
            background: linear-gradient(45deg, #2a6df5, #4fd1ff);
            color: #fff;
            box-shadow: 0 6px 18px rgba(79, 150, 255, 0.4);
        }
        .content .explore-btn::before { /* Shine effect */
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.7s ease;
        }
        .content .explore-btn:hover::before {
             left: 150%;
        }
        .content .explore-btn i {
            margin-left: 10px;
            transition: transform 0.3s ease;
        }
        .content .explore-btn:hover i {
            transform: translateX(5px);
        }
        .content .explore-btn:hover {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 10px 25px rgba(79, 209, 255, 0.6);
        }
         .content .explore-btn:active {
            transform: translateY(-1px) scale(1);
             box-shadow: 0 4px 12px rgba(79, 150, 255, 0.3);
         }

        /* Save Button Styles */
        .content .save-btn {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .content .save-btn i {
            margin-right: 10px;
            color: #ffbdbe; /* Softer pink */
            transition: transform 0.3s ease, color 0.3s ease;
        }
        .content .save-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
        }
        .content .save-btn:hover i {
            transform: scale(1.2);
        }
         .content .save-btn:active {
             transform: scale(0.95);
              box-shadow: none;
         }
        /* Saved state */
        .content .save-btn.saved {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
            color: #fff;
        }
        .content .save-btn.saved i {
            color: #ff4757; /* Brighter red */
            transform: scale(1.1);
            animation: heartBeat 0.5s ease-in-out;
        }
        @keyframes heartBeat {
            0% { transform: scale(1.1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1.1); }
        }


        /* Info Stats Styles */
        .info-stats {
            display: flex;
            gap: 30px;
            margin-top: 30px;
             transform: translateZ(20px); /* Lift stats slightly */
             transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1); /* For parallax */
        }
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Animation handled by JS */
        }
        .stat-value {
            font-size: 22px;
            font-weight: 700;
            color: #4fd1ff;
            margin-bottom: 3px;
        }
        .stat-label {
            font-size: 12px;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Navigation Buttons Styles */
        .nav-buttons {
            position: absolute;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%) translateZ(100px); /* Bring forward */
            display: flex;
            gap: 20px;
            z-index: 100;
        }
        .nav-buttons button {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
            overflow: hidden;
             box-shadow: 0 5px 15px rgba(0,0,0, 0.2);
        }
        .nav-buttons button::before { /* Hover glow */
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(79, 209, 255, 0.5) 0%, rgba(79, 209, 255, 0) 70%);
            border-radius: 50%;
            transform: scale(0);
            transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            opacity: 0;
        }
        .nav-buttons button:hover::before {
            transform: scale(2.5);
            opacity: 1;
        }
        .nav-buttons button i {
            color: white;
            font-size: 18px;
            position: relative;
            z-index: 1;
            transition: transform 0.3s ease;
        }
        .nav-buttons button:hover {
            background: rgba(79, 209, 255, 0.2);
            transform: scale(1.1) translateY(-2px);
            border-color: rgba(79, 209, 255, 0.4);
            box-shadow: 0 8px 25px rgba(79, 209, 255, 0.3);
        }
         .nav-buttons button:active {
             transform: scale(1) translateY(0);
             box-shadow: 0 5px 15px rgba(0,0,0, 0.2);
         }
        .nav-buttons button:hover i {
             transform: scale(1.1);
        }

        /* Pagination Styles */
        .pagination {
            position: absolute;
            bottom: 50px;
            right: 40px;
            display: flex;
            flex-direction: column; /* Stack vertically */
            gap: 12px;
            z-index: 100;
             transform: translateZ(80px); /* Bring forward */
             max-height: calc(85vh - 100px); /* Limit height based on container height */
             overflow-y: auto; /* Allow scroll if too many dots */
             padding: 5px 5px 5px 0; /* Space for scrollbar */
             /* Custom scrollbar (optional) */
             scrollbar-width: thin;
             scrollbar-color: rgba(79, 209, 255, 0.5) rgba(255, 255, 255, 0.1);
        }
         /* Webkit scrollbar */
         .pagination::-webkit-scrollbar {
             width: 5px;
         }
         .pagination::-webkit-scrollbar-track {
             background: rgba(255, 255, 255, 0.1);
             border-radius: 10px;
         }
         .pagination::-webkit-scrollbar-thumb {
             background-color: rgba(79, 209, 255, 0.5);
             border-radius: 10px;
             border: 1px solid rgba(255, 255, 255, 0.1);
         }


        .pagination button.dot { /* Use button for accessibility */
            flex-shrink: 0; /* Prevent dots shrinking */
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
             outline: none;
             border: 1px solid transparent; /* Placeholder for focus */
             padding: 0; /* Remove button padding */
             margin: 0; /* Remove button margin */
        }
         .pagination button.dot:hover {
            background: rgba(255, 255, 255, 0.6);
            transform: scale(1.3);
         }
        .pagination button.dot.active {
            background: #4fd1ff;
            box-shadow: 0 0 15px rgba(79, 209, 255, 0.8);
            transform: scale(1.5);
        }
         .pagination button.dot.active::before { /* Active indicator pulse */
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(79, 209, 255, 0.5);
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            animation: ripple 1.8s infinite ease-out;
            pointer-events: none;
        }
        @keyframes ripple {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }


        /* Floating elements */
        .floating-elements {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
             transform-style: preserve-3d;
        }
        .floating-element {
            position: absolute;
            border-radius: 50%;
            opacity: 0.2;
            filter: blur(25px); /* Increased blur */
            animation: floatAnimation 20s infinite alternate ease-in-out;
             transform-style: preserve-3d;
        }
        .floating-element:nth-child(1) {
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, rgba(79, 209, 255, 0.6) 0%, rgba(79, 109, 253, 0) 75%);
            top: 5%;
            left: 8%;
            animation-delay: 0s;
             transform: translateZ(-80px);
        }
        .floating-element:nth-child(2) {
            width: 350px;
            height: 350px;
            background: radial-gradient(circle, rgba(111, 66, 193, 0.5) 0%, rgba(111, 66, 193, 0) 70%);
            bottom: 5%;
            right: 5%;
            animation-delay: 6s;
             transform: translateZ(-120px);
        }
        @keyframes floatAnimation {
            0% { transform: translateZ(-80px) translateY(0px) translateX(0px); }
            50% { transform: translateZ(-100px) translateY(-25px) translateX(15px); }
            100% { transform: translateZ(-120px) translateY(10px) translateX(-10px); }
        }

        /* Floating Orb */
        .floating-orb {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(79, 109, 253, 0.5) 50%, transparent 100%);
             filter: blur(5px);
            top: 65%;
            left: 85%;
            animation: floatOrb 7s infinite alternate ease-in-out;
            z-index: 1;
             transform: translateZ(-60px);
             pointer-events: none;
        }
        @keyframes floatOrb {
            0% { transform: translateZ(-60px) translateY(0); }
            100% { transform: translateZ(-40px) translateY(-50px) scale(1.1); }
        }


        /* --- Modal Styles --- */
        #modal-overlay { /* For warp effect */
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #0a0a18;
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-out;
        }
         #modal-overlay.warping {
             opacity: 1;
             animation: warp 0.6s ease-in-out forwards;
         }
         @keyframes warp {
            0% { transform: scale(1) rotate(0deg); opacity: 0; }
            20% { transform: scale(1.5) rotate(15deg); opacity: 1; }
            80% { transform: scale(0.01) rotate(-15deg); opacity: 1; }
            100% { transform: scale(0.01) rotate(0deg); opacity: 0; }
         }

        #modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
            opacity: 0;
            transition: opacity 0.4s ease-in-out 0.3s; /* Delay opacity transition */
            pointer-events: none;
        }

        #modal.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content-wrapper {
            background: rgba(25, 25, 55, 0.85);
            margin: 5vh auto;
            padding: 0; /* Remove padding, handle internally */
            border-radius: 20px;
            max-width: 700px;
            width: 85%;
            color: #fff;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-height: 85vh;
            overflow: hidden; /* Hide overflow initially */
            display: flex;
            flex-direction: column; /* Stack header/body/footer */
            transform: scale(0.9);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.3s; /* Delay transform */
             backdrop-filter: blur(15px);
        }

        #modal.visible .modal-content-wrapper {
             transform: scale(1);
        }

        .modal-header {
            padding: 25px 35px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            flex-shrink: 0; /* Prevent header shrinking */
        }
        .modal-header h2 {
            color: #4fd1ff;
            margin: 0;
            font-size: 24px;
             font-weight: 600;
        }

        #modalContent {
             padding: 0; /* Padding handled by #explore-content now */
             overflow-y: hidden; /* Scroll handled by #explore-content */
             flex-grow: 1; /* Take available space */
             position: relative; /* Needed for absolute positioning of generated content */
        }


        #modalContent p { /* Default styling for non-explore content */
            line-height: 1.7;
            margin-bottom: 18px;
             opacity: 0.9;
        }
        #modalContent strong {
            color: #aaa;
            margin-right: 8px;
            font-weight: 600;
        }

        #closeModal {
            position: absolute;
            top: 15px;
            right: 20px;
            cursor: pointer;
            color: #aaa;
            font-size: 32px;
            font-weight: lighter;
            line-height: 1;
            transition: color 0.3s ease, transform 0.3s ease;
            z-index: 1001;
            background: none;
            border: none;
            padding: 5px;
            outline: none;
        }
        #closeModal:hover {
            color: #fff;
            transform: rotate(90deg) scale(1.1);
        }
        /* Responsive Design */
        @media (max-width: 900px) {
             /* Keep most desktop styles but adjust card size slightly */
             .container { height: 80vh; }
             .slide .item { width: 320px; height: 450px; } /* Slightly smaller */
             .nav-buttons { bottom: 25px; }
             .pagination { bottom: 30px; right: 25px; max-height: calc(80vh - 80px); }
             .content .name { font-size: 34px; }
             .content .des { font-size: 14px; }
             /* Adjust hover transform for tablets if needed, current one might be okay */
        }
        @media (max-width: 700px) {
             /* Major changes for mobile */
             .container { width: 95vw; height: 90vh; border-radius: 20px; perspective: 1000px; /* Reduce perspective */ }
             .title { font-size: 20px; top: 20px; }
             .slide .item { /* Adjust mobile card size */ width: clamp(280px, 75vw, 320px); /* Responsive width */ height: clamp(400px, 60vh, 450px); /* Responsive height */ }
             .nav-buttons { gap: 15px; transform: translateX(-50%) translateZ(60px); /* Less Z */ }
             .nav-buttons button { width: 50px; height: 50px; }
             .pagination { gap: 10px; bottom: 25px; right: 20px; transform: translateZ(50px); max-height: calc(90vh - 100px);}
             .pagination button.dot { width: 8px; height: 8px; }
             /* Adjust content for smaller cards */
             .content .name { font-size: 28px; }
             .content .des { font-size: 13px; max-width: 100%; line-height: 1.5em; margin: 15px 0; }
             .content .button-group { flex-direction: column; gap: 12px; align-items: flex-start; margin-top: 20px;}
             .info-stats { gap: 20px; margin-top: 25px; }
             .stat-value { font-size: 18px; }
             .stat-label { font-size: 10px; }
             /* Modal adjustments */
             .modal-content-wrapper { width: 90%; max-height: 85vh; }
             .modal-header { padding: 20px 25px; }
             .modal-header h2 { font-size: 20px; }
             #modalContent { padding: 0; } /* Remove padding */
             #closeModal { font-size: 28px; top: 10px; right: 15px; }

             /* Disable complex hover on mobile */
             .item:hover { /* Reset hover effect to base state defined by JS transform */ /* transform: var(--base-transform); /* Needs JS to set base */ box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4); /* Revert to base shadow */ /* Or simply prevent hover changes */ /* pointer-events: none; /* This might be too much */ }
             /* Prevent hover on the specific card that IS NOT main */
             .slide .item:not(.main-display):hover { /* Explicitly define the non-hovered transform - gets complex */ /* Easier to just disable the scale/z-lift part via media query */ transform: var(--js-transform, translate(-50%, -50%)); /* Use JS-set transform */ box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4); }
             /* Specific adjustments for explore content on mobile */
              #explore-content { padding: 15px; } /* Apply padding to the dynamic content */
              #explore-content h2 { font-size: 1.5em; margin-bottom: 20px; }
              .topic-section h3 { font-size: 1.15em; }
              details p { font-size: 0.9em; }
              .hindu-connection h4 { font-size: 1em; }
              .hindu-connection p { font-size: 0.85em; }

        }

    </style>

    <style>
        /* Styles for Explore Content (applied dynamically via #explore-content ID) */
        #explore-content {
            padding: 10px 20px 20px 20px; /* Adjusted padding */
            line-height: 1.6;
            color: #eee; /* Light text color */
            height: 100%; /* Allow it to fill modalContent */
            max-height: 70vh; /* Limit height */
            overflow-y: auto; /* Enable scrolling */
            /* Custom scrollbar (optional, for WebKit browsers) */
            scrollbar-width: thin; /* For Firefox */
            scrollbar-color: #4dd0e1 #0a0a18; /* For Firefox */
        }
        /* WebKit scrollbar styling */
        #explore-content::-webkit-scrollbar {
            width: 8px;
        }
        #explore-content::-webkit-scrollbar-track {
            background: rgba(10, 10, 24, 0.8); /* Dark track */
            border-radius: 4px;
        }
        #explore-content::-webkit-scrollbar-thumb {
            background-color: #4dd0e1; /* Accent color thumb */
            border-radius: 4px;
            border: 2px solid rgba(10, 10, 24, 0.8); /* Match track background */
        }
        #explore-content h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #4dd0e1; /* Accent color */
            font-size: 1.8em;
            font-weight: 600;
            text-shadow: 0 0 5px rgba(77, 208, 225, 0.5);
        }
        .topic-section {
            margin-bottom: 25px; /* Slightly reduced margin */
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.04); /* Slightly more subtle background */
            border-radius: 8px;
            border-left: 4px solid #4dd0e1; /* Accent border */
            transition: background-color 0.3s ease;
        }
        .topic-section:hover {
            background-color: rgba(255, 255, 255, 0.07);
        }
        .topic-section h3 {
            margin-bottom: 15px;
            color: #81d4fa; /* Lighter blue for headings */
            display: flex;
            align-items: center;
            font-size: 1.3em;
            font-weight: 500;
        }
        .topic-section h3 i {
            margin-right: 12px; /* Increased spacing */
            color: #4dd0e1;
            width: 20px; /* Ensure consistent icon width */
            text-align: center;
        }

        details {
            margin-bottom: 12px; /* Increased margin */
            background-color: rgba(0, 0, 0, 0.25); /* Darker background */
            border-radius: 5px; /* Slightly more rounded */
            padding: 8px 12px; /* Adjusted padding */
            border: 1px solid rgba(77, 208, 225, 0.2); /* Subtle border */
            transition: background-color 0.3s ease;
        }
        details:hover {
            background-color: rgba(0, 0, 0, 0.35);
        }
        details[open] {
            background-color: rgba(77, 208, 225, 0.1); /* Highlight when open */
        }

        summary {
            cursor: pointer;
            font-weight: bold;
            color: #b3e5fc; /* Light blue for summaries */
            padding: 5px 0;
            list-style: none; /* Remove default marker */
            display: block; /* Ensure it takes full width */
            position: relative;
        }
        summary::-webkit-details-marker { display: none; } /* Hide Safari marker */
        summary::before { /* Custom marker */
            content: '\\f0da'; /* FontAwesome right arrow */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-right: 8px;
            color: #4dd0e1;
            transition: transform 0.2s ease-in-out;
            display: inline-block;
        }
        details[open] > summary::before {
            transform: rotate(90deg); /* Rotate arrow when open */
        }

        details p {
            margin-top: 10px; /* Increased top margin */
            padding-left: 25px; /* Indent paragraph more */
            color: #d1d1d1; /* Lighter text for details */
            font-size: 0.95em;
        }

        .hindu-connection {
            margin-top: 15px;
            padding: 12px 15px; /* Adjusted padding */
            background-color: rgba(255, 171, 64, 0.08); /* Light accent background (saffron) */
            border-radius: 5px;
            border-left: 3px solid #ffab40; /* Saffron/Orange accent */
            border-top: 1px solid rgba(255, 171, 64, 0.2); /* Subtle top border */
        }
        .hindu-connection h4 {
            margin-bottom: 8px; /* Increased margin */
            color: #ffcc80; /* Saffron/Orange color */
            display: flex;
            align-items: center;
            font-size: 1.1em;
            font-weight: 500;
        }
        .hindu-connection h4 i.fa-om {
            margin-right: 10px;
            color: #ffab40;
            font-size: 1.1em;
        }
        .hindu-connection p {
            color: #e0e0e0;
            font-size: 0.9em;
            padding-left: 5px; /* Slight indent */
        }
</style>
</head>
<body>
    <div id="preloader">
        <div class="loader"></div>
    </div>
    <div id="modal-overlay"></div>
    <div id="background-wrapper">
        <div id="apod-background-overlay"></div>
        <div class="container">
            <div id="particles"></div>
            <div class="title" style="font-size: 50px;"> COSMIC TOUR</div>
            <div class="slide" id="slideContainer">
                </div>
            <div class="nav-buttons">
                <button id="prevBtn" aria-label="Previous Destination"><i class="fas fa-chevron-left"></i></button>
                <button id="nextBtn" aria-label="Next Destination"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="pagination" id="paginationContainer">
                </div>
            <div class="floating-elements">
                <div class="floating-element"></div>
                <div class="floating-element"></div>
            </div>
            <div class="floating-orb"></div>
        </div>
    </div>

    <div id="modal">
        <div class="modal-content-wrapper">
            <div class="modal-header">
                <h2 id="modal-title">Explore Cosmic Wonders</h2> <button id="closeModal" aria-label="Close Modal">&times;</button>
            </div>
            <div id="modalContent">
                </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Configuration ---
            const NASA_API_KEY = 'DEMO_KEY'; // Use 'DEMO_KEY' or get yours from api.nasa.gov
            const APOD_API_URL = `https://api.nasa.gov/planetary/apod?api_key=${NASA_API_KEY}`;
            const PARTICLE_COUNT = 100;
            const ENABLE_SOUNDS = true; // Set to false to disable sounds
            const MOBILE_BREAKPOINT = 700; // px, screen width for mobile adjustments

            // --- Data with Specific Explore Content ---
            const destinations = [
                 {
                    id: 'STARS',
                    name: "STARS",
                    location: "Scattered across galaxies",
                    description: "Stars are giant, hot gas spheres that shine by fusing hydrogen into helium, producing light, heat, and supporting life systems.",
                    images: [
                        'https://cdn.kastatic.org/ka-perseus-images/dbf89ed41a7fbdff0c972d6c8f2e43571ce71dcd.jpg', // Galaxy
                        'https://miro.medium.com/v2/resize:fit:1200/1*tM3JO0Rq4Xz4IW1KMbMgOA.jpeg', // Spiral arms
                        'https://images.unsplash.com/photo-1447433589675-4aaa569f3e05?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80'  // Star cluster
                    ],
                    cardImage: 'https://cdn.kastatic.org/ka-perseus-images/dbf89ed41a7fbdff0c972d6c8f2e43571ce71dcd.jpg', // Card-specific aspect ratio
                    stats: { distance: "4.24M", unit: "Light Years", features: "Fusion ", featureUnit: "Energy", missions: 3},
                    // --- Specific Explore HTML for STARS ---
                    exploreHTML: `
                        <div id="explore-content">
                            <h2>Explore: Stars</h2>
                            <div class="topic-section">
                                <h3><i class="fas fa-star"></i> Stars Q&A</h3>
                                <details>
                                    <summary><strong>Q1: What are stars made of, and how do they produce light and heat?</strong></summary>
                                    <p>Stars are huge balls of hot gases, mainly hydrogen and helium. Inside them, hydrogen turns into helium through a process called nuclear fusion. This creates a lot of energy, which comes out as heat and light.</p>
                                </details>
                                <details>
                                    <summary><strong>Q2: How do stars evolve — from birth to death?</strong></summary>
                                    <p>Stars are born in gas clouds called nebulae. They shine for millions or billions of years. Small stars become white dwarfs. Big stars explode as supernovas and become neutron stars or black holes after death.</p>
                                </details>
                                <details>
                                    <summary><strong>Q3: How important is our Sun compared to other stars?</strong></summary>
                                    <p>The Sun is a medium-sized star, but it's very important for us because it gives Earth heat and light. Without the Sun, life on Earth would not be possible. It's the center of our solar system.</p>
                                </details>
                                <div class="hindu-connection">
                                    <h4><i class="fas fa-om"></i> Hindu connection – Surya as cosmic energy</h4>
                                    <p>In Hinduism, Surya (the Sun God) is worshipped as the source of all energy and life. Like the Sun gives energy to our planet, Surya is seen as the divine power that sustains the whole universe.</p>
                                </div>
                            </div>
                        </div>
                    `
                 },
                 {
                    id: 'PLANETS',
                    name: "PLANETS",
                    location: "Orbit stars",
                    description: "Planets are round bodies orbiting stars, made of rock or gas, some with air, water, and potential to support life.",
                    images: [
                        'https://orbitaltoday.com/wp-content/uploads/2023/05/How-Many-Planets-are-there-in-Our-Solar-System.jpg', // Exoplanet concept
                        'https://images.unsplash.com/photo-1516339901601-2e1b62dc0c45?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80', // Red dwarf star field
                        'https://images.unsplash.com/photo-1584233812253-2ff74a097283?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80'  // Rocky alien surface
                    ],
                    cardImage: 'https://orbitaltoday.com/wp-content/uploads/2023/05/How-Many-Planets-are-there-in-Our-Solar-System.jpg',
                    stats: { distance: "150M", unit: "Kilometers", features: "Habitability", featureUnit: "Zone", missions: 4},
                    // --- Specific Explore HTML for PLANETS ---
                    exploreHTML: `
                        <div id="explore-content">
                            <h2>Explore: Planets</h2>
                            <div class="topic-section">
                                <h3><i class="fas fa-globe-americas"></i> Planets Q&A</h3>
                                <details>
                                    <summary><strong>Q1: How are planets formed, and what makes one habitable?</strong></summary>
                                    <p>Planets form from dust and gas left over after stars are born. A planet is habitable if it has water, air, and the right temperature, like Earth. It must not be too hot or too cold.</p>
                                </details>
                                <details>
                                    <summary><strong>Q2: Why is Earth the only known planet with life?</strong></summary>
                                    <p>Earth has water, oxygen, sunlight, and the perfect temperature for living things to survive. It also has a protective atmosphere and magnetic field, which keep harmful space rays and meteors away.</p>
                                </details>
                                <details>
                                    <summary><strong>Q3: What are exoplanets, and how are they found?</strong></summary>
                                    <p>Exoplanets are planets outside our solar system. Scientists find them by watching stars and seeing tiny dips in light, which happen when a planet passes in front. Special telescopes help us find them.</p>
                                </details>
                                <div class="hindu-connection">
                                    <h4><i class="fas fa-om"></i> Hindu connection – Navagrahas (Nine Planets)</h4>
                                    <p>In Hinduism, the Navagrahas are nine celestial bodies including planets. They are believed to affect human life. This shows ancient people knew planets had importance and influence, much before modern science.</p>
                                </div>
                            </div>
                        </div>
                    `
                 },
                 {
                    id: 'GALAXIES',
                    name: "GALAXIES",
                    location: "Universe-wide, in clusters",
                    description: "Galaxies are huge space systems of stars, gas, and dust, shaped by gravity and containing billions of stars and planets.",
                    images: [
                        'https://telescope.live/sites/default/files/styles/front_page_obs_w696_h452/public/2023-09/shutterstock_738535111.jpg?itok=88mOD1sG', // Wide nebula shot
                        'https://images.unsplash.com/photo-1465101162946-4377e57745c3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80', // Colorful gas clouds
                        'https://images.unsplash.com/photo-1446776811953-b23d57bd21aa?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80' // Star formation detail
                    ],
                    cardImage: 'https://telescope.live/sites/default/files/styles/front_page_obs_w696_h452/public/2023-09/shutterstock_738535111.jpg?itok=88mOD1sG',
                    stats: { distance: "2.5M", unit: "Light Years", features: "Stellar", featureUnit: "System", missions: 3 },
                     // --- Specific Explore HTML for GALAXIES ---
                    exploreHTML: `
                        <div id="explore-content">
                            <h2>Explore: Galaxies</h2>
                            <div class="topic-section">
                                <h3><i class="fas fa-atom"></i> Galaxies Q&A</h3>
                                <details>
                                    <summary><strong>Q1: What are galaxies, and what are the types?</strong></summary>
                                    <p>Galaxies are giant collections of stars, planets, gas, and dust held together by gravity. There are spiral (like the Milky Way), elliptical, and irregular galaxies. Each can have billions of stars and solar systems.</p>
                                </details>
                                <details>
                                    <summary><strong>Q2: How many galaxies are in the universe?</strong></summary>
                                    <p>Scientists believe there are around 2 trillion galaxies in the observable universe. This number might grow as telescopes get better. Each galaxy is like its own island in space, full of stars and planets.</p>
                                </details>
                                <details>
                                    <summary><strong>Q3: What happens when two galaxies collide?</strong></summary>
                                    <p>When galaxies crash, stars usually don't hit each other because space is very big. But gas clouds mix, and new stars are born. It changes the shape of galaxies, but life on planets may survive.</p>
                                </details>
                                <div class="hindu-connection">
                                    <h4><i class="fas fa-om"></i> Hindu connection – 14 Lokas (Worlds)</h4>
                                    <p>Hindu scriptures talk about 14 Lokas or cosmic realms. These can be imagined like different galaxies or dimensions, showing that ancient knowledge believed in a vast, layered universe — just like science now sees.</p>
                                </div>
                            </div>
                        </div>
                    `
                 },
                 {
                    id: 'NEBULAE',
                    name: "NEBULAE",
                    location: "Inside galaxies, near stars",
                    description: "Nebulae are colorful space clouds of gas and dust where stars are born or die, glowing or blocking light beautifully.",
                    images: [
                        'https://wp.goingtospace.com/wp-content/uploads/9999/06/B148A219-205E-4E25-A68D-842B3AF052E0.jpeg', // Saturn with rings prominent
                        'https://images.unsplash.com/photo-1545156521-8be1b291a587?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80', // Ring detail / closeup
                        'https://images.unsplash.com/photo-1614314107880-4918041a1940?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80'  // Moon near rings
                    ],
                    cardImage: 'https://wp.goingtospace.com/wp-content/uploads/9999/06/B148A219-205E-4E25-A68D-842B3AF052E0.jpeg',
                    stats: { distance: "1,344", unit: "Light Years", features: "Star", featureUnit: "Formation", missions: 3 },
                     // --- Specific Explore HTML for NEBULAE ---
                    exploreHTML: `
                        <div id="explore-content">
                             <h2>Explore: Nebulae</h2>
                            <div class="topic-section">
                                <h3><i class="fas fa-cloud"></i> Nebulae Q&A</h3>
                                <details>
                                    <summary><strong>Q1: What are nebulae, and why are they called “star nurseries”?</strong></summary>
                                    <p>Nebulae are colorful clouds of gas and dust in space. They are called "star nurseries" because new stars are born inside them. Gravity pulls gas together to start the life of a star.</p>
                                </details>
                                <details>
                                    <summary><strong>Q2: What are the types of nebulae?</strong></summary>
                                    <p>There are four types: emission (glow from hot gas), reflection (light reflected from stars), dark (block light behind them), and planetary nebulae (from dying stars). Each looks different and plays a role in space.</p>
                                </details>
                                <details>
                                    <summary><strong>Q3: Can life begin near a nebula?</strong></summary>
                                    <p>It’s unlikely because nebulae are full of strong radiation and unstable energy. But the stars made inside them can later have planets, where life might start, just like our Sun formed from a nebula.</p>
                                </details>
                                <div class="hindu-connection">
                                    <h4><i class="fas fa-om"></i> Hindu connection – Brahmaanda (Cosmic Egg)</h4>
                                    <p>Hindu texts describe the universe as “Brahmaanda” or a cosmic egg, where all creation begins. Nebulae are similar in science — the starting points of stars, planets, and galaxies. Both show creative beginnings.</p>
                                </div>
                            </div>
                        </div>
                    `
                 },
                  {
                    id: 'BLACK HOLES',
                    name: "BLACK HOLES",
                    location: "Galactic centers or scattered",
                    description: "Black holes are collapsed stars with powerful gravity, pulling in everything, even light. They can grow by swallowing matter and merging.",
                    images: [
                        'https://cdn.mos.cms.futurecdn.net/iJfPWRCDs7nQjLL7nNnxF7.jpg', // Jupiter full disk
                        'https://images.unsplash.com/photo-1614907133880-1ea19c809175?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80', // Great Red Spot detail
                        'https://images.unsplash.com/photo-1634429310016-6645538550b3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80'  // Swirling clouds
                    ],
                    cardImage: 'https://cdn.mos.cms.futurecdn.net/iJfPWRCDs7nQjLL7nNnxF7.jpg',
                    stats: { distance: "26,000", unit: "Light Years", features: "Extreme", featureUnit: "Gravity", missions: 3 },
                     // --- Specific Explore HTML for BLACK HOLES ---
                    exploreHTML: `
                        <div id="explore-content">
                             <h2>Explore: Black Holes</h2>
                            <div class="topic-section">
                                <h3><i class="fas fa-circle-notch fa-spin" style="--fa-animation-duration: 5s;"></i> Black Holes Q&A</h3>
                                <details>
                                    <summary><strong>Q1: What is a black hole, and how is it made?</strong></summary>
                                    <p>A black hole forms when a very big star dies and collapses. Its gravity becomes so strong that nothing, not even light, can escape. It sucks in everything around it, like a space vacuum.</p>
                                </details>
                                <details>
                                    <summary><strong>Q2: What happens if you fall into a black hole?</strong></summary>
                                    <p>If you fall in, you would get stretched like spaghetti because of strong gravity. Time slows down, and once you cross the center (called the event horizon), you can’t return. It's a one-way trip.</p>
                                </details>
                                <details>
                                    <summary><strong>Q3: Can black holes connect parts of the universe?</strong></summary>
                                    <p>Some scientists think black holes might be like portals or wormholes to other parts of space, or even other universes. But it's just a theory — no one has proven it yet.</p>
                                </details>
                                <div class="hindu-connection">
                                    <h4><i class="fas fa-om"></i> Hindu connection – Shiva as the destroyer</h4>
                                    <p>In Hinduism, Shiva destroys to allow new creation. A black hole also destroys stars, but can trigger the birth of new ones. It reflects the cosmic cycle of end and rebirth — just like Shiva.</p>
                                </div>
                            </div>
                        </div>
                    `
                 },
                  {
                    id: 'DARK MATTER',
                    name: "DARK MATTER",
                    location: "Around/within galaxies",
                    description: "Dark matter is invisible material shaping galaxies with gravity. Though unseen, it makes up most of the universe’s total mass.",
                    images: [
                        'https://cdn.mos.cms.futurecdn.net/BzT9Jaxr7ceVLY9HVWNvTj-320-80.jpg', // Orion Nebula wide view
                        'https://images.unsplash.com/photo-1610987081691-1806a438020e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80', // Trapezium cluster detail
                        'https://images.unsplash.com/photo-1608178398319-48f814d0750c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80'  // Gas pillars/textures
                    ],
                    cardImage: 'https://cdn.mos.cms.futurecdn.net/BzT9Jaxr7ceVLY9HVWNvTj-320-80.jpg',
                    stats: { distance: " Universal", unit: "Distance", features: "Invisible", featureUnit: "Mass", missions: 3 },
                     // --- Specific Explore HTML for DARK MATTER ---
                    exploreHTML: `
                        <div id="explore-content">
                             <h2>Explore: Dark Matter</h2>
                            <div class="topic-section">
                                <h3><i class="fas fa-question-circle"></i> Dark Matter Q&A</h3>
                                <details>
                                    <summary><strong>Q1: What is dark matter, and why can’t we see it?</strong></summary>
                                    <p>Dark matter is something we cannot see or touch, but we know it's there because it holds galaxies together. It doesn’t make light or energy, which is why it's invisible. It’s like an invisible glue.</p>
                                </details>
                                <details>
                                    <summary><strong>Q2: How do scientists detect dark matter?</strong></summary>
                                    <p>Scientists can't see dark matter directly. They notice how stars and galaxies move differently, like something invisible is pulling them. This shows that some hidden mass, or dark matter, is affecting gravity.</p>
                                </details>
                                <details>
                                    <summary><strong>Q3: Why is dark matter important for galaxies?</strong></summary>
                                    <p>Without dark matter, galaxies would fly apart because gravity wouldn’t be strong enough. Dark matter gives galaxies extra gravity, helping them stay in shape. It makes up most of the mass in the universe.</p>
                                </details>
                                <div class="hindu-connection">
                                    <h4><i class="fas fa-om"></i> Hindu connection – Avyakta Prakriti (Unseen Nature)</h4>
                                    <p>Hindu texts speak of "Avyakta," the unmanifested force behind all creation. Dark matter is also unseen but shapes the universe. Both show that the invisible is powerful and essential to holding everything together.</p>
                                </div>
                            </div>
                        </div>
                    `
                 }
            ];

            // --- DOM Elements ---
            const container = document.querySelector('.container');
            const slideContainer = document.getElementById('slideContainer');
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            const paginationContainer = document.getElementById('paginationContainer');
            const particlesContainer = document.getElementById('particles');
            const preloader = document.getElementById('preloader');
            const apodOverlay = document.getElementById('apod-background-overlay');
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modalContent');
            const modalTitle = document.getElementById('modal-title');
            const closeModalBtn = document.getElementById('closeModal');
            const modalOverlay = document.getElementById('modal-overlay'); // Warp effect

            // --- State Variables ---
            let currentIndex = 0;
            let isAnimating = false;
            let items = []; // Will hold the DOM elements for items
            let backgroundItems = []; // Hold background divs
            let dots = []; // Hold pagination dot elements
            let savedDestinations = JSON.parse(localStorage.getItem('savedCosmicDestinations')) || {};
            let audioContext;
            let navigateSoundBuffer;
            let selectSoundBuffer;
            let saveSoundBuffer;
            let exploreSoundBuffer;
            let isMobile = window.innerWidth <= MOBILE_BREAKPOINT;

            // --- Audio Setup ---
            async function setupAudio() {
                if (!ENABLE_SOUNDS || !window.AudioContext || typeof AudioContext === 'undefined') return;
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    [navigateSoundBuffer, selectSoundBuffer, saveSoundBuffer, exploreSoundBuffer] = await Promise.all([
                        loadSound('data:audio/wav;base64,UklGRjoAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YRYAAAAaAAA/AEEAOwAuAEEAOgA3AEMAUgBVAG4AaQByAHgAegCBAJIApwCmAJsAiwCEAIMAigCTAJsAogCbAJQAhQCEAHwAewB4AHcAbgBrAGgAZwBkAGIAYQBgAFwAVQBSAE8ASwBGAEEAPgA8ADgAOAAvACwAKgAlACIAIAAcABoAGgAZABcAFgAVABUAFgAXABkAGwAeACIAJgAqAC4AMgA1ADgAOwA/AEMARgBJAEwATwBSAFUAVwBZAFwAWgBXAFUAUwBRAE4ASgBHAEUAYQ=='), // Simple swoosh/click
                        loadSound('data:audio/wav;base64,UklGRkIAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YUwBAAAaAEEATwB8AKgAuwDZAPQBDgEiAT8BZwGgAc8B/QI4A04DXAOMA7QEEwUhBV8GZwdtB6oIFAn0CrALVgyeDNsN+Q9JD/0SIBM8FGwVahfSGCsZZBpuG4Qc2h3aHtsgESCKIXki+CPiI/klHyYvJwonZyi2KiEq5SxBLPAtZy8LMJgwvDGIMqwywDOkNBo3XDjXOf87+j6AP4RBUYRzhY4Gf4nFi4gM/w5xD8AQShLzFLcU/xWmFmwXkRjLGbEaIRs9HBEdBh4pHykfZR/eIEYhHyIlI/MlFyY/JyIoYyrPK0gspi2eLoQvoi/rMIgz/DTsNfM30zjzOso9Pj7sP2JBA0L1RRNGP0laSn5Lc0yJTQROEU8RUBlSR1NTVFVWYVdmWGhaZlpvXnFffWCFYYlSjG+OkZAUk1OUQVRPVmxcl15wX3phf2OLZDZ+'), // Subtle confirmation
                        loadSound('data:audio/wav;base64,UklGRlwAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YUgAAAAgACwAYQCHALUAywDbAPgA/QERASoBPgFnAaMBxgHxAfsCJwM0A2kDmAPGA/8EGQUtBkEGWQaNB5kIEwnqCysL/gyjDfkQaxM8FTsWehhtGnEc7B8VIhYkwSS7Jqkn2ijvK1QrqSw3LY4uKzBlMokzwDQPNhU44Dn9PQo/vEJMRVpIoEutTKVQklVeWmxdjmCLZpJroXGvdLJ4xH3UgwaJk5VYnm+mcKtzwHT4fQSCiIyyl3Ccqa24vcTKy9PP1djh5uvu9vsH/w/+DgAoAFgApQDJANwA/gIdAj8BbAHHAfoCGQM7A3kDvgQ1BRYGZgf+CEwKIwwGDiMPghE3EqcUHxeFGK4a8x0hIAIhjyTlJgQoQirMK8Ut8DAHMo81+zfpOxc97UBJQ2JGV0phTLZPWVVeWnNeiGK+aKFytnmNfpmGoIumqK+yusq+x83a4ufl8Pj7/xT/DQAoAC8AQQBJAFUAcACCALQAzwDoAQcBHwEzAU8BbQGjAdUB6wINAh0CRwJdAncClQKoAskC7gMcAxIDIgM/A00DUgNbA3QDewOGA5sDpQPVA+gD/AQUBCsEMAReBFwEYAScBKwEzAUOBRsFOAVmBXgFkAWqBbEFuQXKBdAF4AXrBgIDCAMLAxcDGQMnAykDLAM4Az0DQQNBA0UDSgNPA1U=') // Soft chime
                    ]);
                    exploreSoundBuffer = await loadSound('data:audio/wav;base64,UklGRoAAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YYQAAAD6//8C//n+/gEJAf39+gDxAAsCDwEmAbwAeAEWAmUA6wBeABgB9v/U/6T9oPwz96T4D/eO+A/74v8uAcsBLAGzAcUAvgDdALkAlQG8AMv/sABPAc3/6v4O/vX+H/zX/sT/yP9i/w4ALQE/AXQBswG7AcQBygHfAfkCBgMbAyYDNgOIA6wD0gPxA/wEBgQuBE8EZgRwBHwEkASpBNQFyAXPBhMGIwYtBmEGfgcWBywHMwdZB3QHjAewB8YIAgkvCTkKOgqVCsYLHAxjDG4MrQzRDOUNDA2+DfUOPQ/2ECoSLRMuEz8UPxVEFkEXeRiBGaUbDRvLHPge/yAzIlEiOiNfJHMlciZmJ0wogiqaKtIr0SzkLlsvAzBvMawzBDQhNeI39zo9PNQ+GD/dQBlCcUTNRVpHe0l1SyJNNE7bT/JSVVNjV35YfFnKXald1l/RYWdkbmZrbHBvcHJ2dnx5e399gIGEg4aHiYiLjI6PkJGSk5SVlpeYmZqbnJ2en6ChoqOkpaanqKmqq6ytrq+wsbKztLW2t7i5uru8vb6/wMHCw8TFxsfIycrLzM3Oz9DR0tPU1dbX2Nna29zd3t/g4eLj5OXm5+jp6uvs7e7v8PHy8/T19vf4+fr7/P3+/wACAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGxwdHh8gISIjJCUmJygpKissLS4vMDEyMzQ1Njc4OTo7PD0+P0BBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWltcXV5fYGFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6e3x9fn8='); // Slightly longer, more involved sound
                    console.log("Audio setup complete.");
                } catch (error) {
                    console.error('Error setting up audio:', error);
                }
            }

            async function loadSound(url) {
                if (!audioContext) return null;
                try {
                    const response = await fetch(url);
                    const arrayBuffer = await response.arrayBuffer();
                    return await audioContext.decodeAudioData(arrayBuffer);
                } catch (error) {
                    console.error(`Error loading sound: ${url}`, error);
                    return null;
                }
            }

            function playSound(buffer) {
                if (!ENABLE_SOUNDS || !audioContext || !buffer || audioContext.state === 'suspended') return;
                try {
                    const source = audioContext.createBufferSource();
                    source.buffer = buffer;
                    source.connect(audioContext.destination);
                    source.start();
                } catch (error) {
                    console.error('Error playing sound:', error);
                }
            }

            function initAudio() { // Resume context on user gesture
                if (ENABLE_SOUNDS && audioContext && audioContext.state === 'suspended') {
                    audioContext.resume().catch(e => console.error("Audio context resume failed:", e));
                }
            }

            // --- UI Creation ---
            function createItem(destination, index) {
                 const item = document.createElement('div');
                 item.classList.add('item');
                 item.style.backgroundImage = `url(${destination.cardImage})`;
                 item.dataset.index = index;
                 item.dataset.id = destination.id; // Add ID for saving

                 const content = document.createElement('div');
                 content.classList.add('content');

                 content.innerHTML = `
                    <div class="location-info"><i class="fas fa-map-marker-alt"></i> ${destination.location}</div>
                    <div class="name">${destination.name}</div>
                    <div class="des">${destination.description.substring(0, 150)}...</div>
                    <div class="info-stats">
                         <div class="stat">
                             <span class="stat-value">${destination.stats.distance}</span>
                             <span class="stat-label">${destination.stats.unit}</span>
                         </div>
                         <div class="stat">
                             <span class="stat-value">${destination.stats.features}</span>
                             <span class="stat-label">${destination.stats.featureUnit}</span>
                         </div>
                         <div class="stat">
                             <span class="stat-value">${destination.stats.missions}</span>
                             <span class="stat-label">Missions</span>
                         </div>
                     </div>
                    <div class="button-group">
                        <button class="explore-btn" aria-label="Explore ${destination.name}"><i class="fas fa-info-circle"></i> Explore</button>
                        <button class="save-btn" aria-label="Save ${destination.name}" data-id="${destination.id}">
                            <i class="far fa-heart"></i> Save
                        </button>
                    </div>
                 `;
                 item.appendChild(content);

                // Add event listener for modal
                const exploreButton = content.querySelector('.explore-btn');
                if (exploreButton) {
                    exploreButton.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent card click propagation
                        initAudio();
                        playSound(exploreSoundBuffer);
                        // Pass the specific destination object to showModal
                        showModal(destination);
                    });
                }

                // Add event listener for save button
                const saveButton = content.querySelector('.save-btn');
                if (saveButton) {
                    updateSaveButtonState(saveButton, destination.id); // Initial state
                    saveButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        initAudio();
                        toggleSaveDestination(destination.id, saveButton);
                    });
                }

                 return item;
             }

            function createBackgroundItem(imageUrl, index) {
                 const bgItem = document.createElement('div');
                 bgItem.classList.add('item', 'full-background');
                 bgItem.style.backgroundImage = `url(${imageUrl})`;
                 bgItem.dataset.index = index;
                 return bgItem;
             }

            function createPaginationDot(index) {
                 const dotButton = document.createElement('button');
                 dotButton.classList.add('dot');
                 dotButton.dataset.index = index;
                 dotButton.setAttribute('aria-label', `Go to destination ${index + 1}`);
                 dotButton.addEventListener('click', () => {
                     initAudio();
                     playSound(selectSoundBuffer);
                     updateSlide(index);
                 });
                 return dotButton;
             }

            function createParticles() {
                if (!particlesContainer) return;
                // Clear existing particles if any
                particlesContainer.innerHTML = '';
                for (let i = 0; i < PARTICLE_COUNT; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    particle.style.top = `${Math.random() * 100}%`;
                    particle.style.left = `${Math.random() * 100}%`;
                    particle.style.animationDelay = `${Math.random() * 4}s`; // Stagger animation start
                    particle.style.animationDuration = `${3 + Math.random() * 3}s`; // Vary duration slightly
                    particlesContainer.appendChild(particle);
                }
            }


            // --- Slide Logic ---
             function updateSlide(newIndex, initialLoad = false) {
                 if (isAnimating && !initialLoad) return;
                 isAnimating = true;

                 const numItems = destinations.length;
                 if (newIndex < 0) {
                     newIndex = numItems - 1;
                 } else if (newIndex >= numItems) {
                     newIndex = 0;
                 }

                 const oldIndex = currentIndex;
                 currentIndex = newIndex;

                 // --- Background Handling ---
                 const mainBg = backgroundItems.find(item => item.classList.contains('main-display'));
                 const previewBg = backgroundItems.find(item => item.classList.contains('background-preview'));

                 if (mainBg && previewBg) {
                     // Update preview first with the image from the *new* current destination
                     previewBg.style.backgroundImage = `url(${destinations[currentIndex].images[0]})`; // Use first image for BG

                     // Swap classes after a delay to allow fade effect
                     setTimeout(() => {
                         mainBg.classList.remove('main-display');
                         mainBg.classList.add('background-preview');
                         previewBg.classList.remove('background-preview');
                         previewBg.classList.add('main-display');
                     }, initialLoad ? 0 : 300); // Shorter delay for background swap
                 }


                 // --- Card Positioning & Styling ---
                 const centerIndex = currentIndex;
                 const right1Index = (centerIndex + 1) % numItems;
                 const right2Index = (centerIndex + 2) % numItems;
                 // Calculate hidden positions based on the new center
                 const hiddenRightIndex = (centerIndex + 3) % numItems;
                 const hiddenLeftIndex = (centerIndex - 1 + numItems) % numItems;

                 items.forEach((item, i) => {
                     const itemIndex = parseInt(item.dataset.index);
                     item.classList.remove('is-center', 'is-right-1', 'is-right-2', 'is-hidden-left', 'is-hidden-right', 'main-display', 'active-content');
                     let transformStyle = '';

                     // Determine position class and apply transforms
                     if (itemIndex === centerIndex) {
                         item.classList.add('is-center', 'main-display');
                         transformStyle = `translate(-50%, -50%) translateZ(0px) rotateY(0deg) scale(1)`;
                     } else if (itemIndex === right1Index) {
                         item.classList.add('is-right-1');
                         transformStyle = `translate(-50%, -50%) translateX(200px) translateZ(-150px) rotateY(-25deg) scale(0.85)`;
                     } else if (itemIndex === right2Index) {
                         item.classList.add('is-right-2');
                         transformStyle = `translate(-50%, -50%) translateX(350px) translateZ(-300px) rotateY(-40deg) scale(0.7)`;
                      } else if (itemIndex === hiddenLeftIndex) {
                         item.classList.add('is-hidden-left');
                         // Start from a position further left for smoother entry
                          transformStyle = `translate(-50%, -50%) translateX(-350px) translateZ(-300px) rotateY(40deg) scale(0.7)`;
                     } else { // All others are hidden far right initially
                         item.classList.add('is-hidden-right');
                         transformStyle = `translate(-50%, -50%) translateX(500px) translateZ(-450px) rotateY(-55deg) scale(0.55)`;
                     }

                     item.style.transform = transformStyle;
                     // Adjust z-index based on class for correct layering
                    if (item.classList.contains('is-center')) {
                        item.style.zIndex = 3;
                    } else if (item.classList.contains('is-right-1')) {
                        item.style.zIndex = 2;
                    } else if (item.classList.contains('is-right-2')) {
                        item.style.zIndex = 1;
                    } else {
                        item.style.zIndex = 0; // Hidden items
                    }


                    // Trigger content animation for the center item
                    if (itemIndex === centerIndex) {
                         setTimeout(() => {
                            item.classList.add('active-content');
                         }, initialLoad ? 100 : 500); // Delay content animation slightly after card settles
                    }
                 });

                 // --- Update Pagination ---
                 dots.forEach((dot, i) => {
                     dot.classList.toggle('active', i === currentIndex);
                 });

                // Allow new animations after the transition completes
                 setTimeout(() => {
                     isAnimating = false;
                 }, 700); // Match the longest transition duration
             }

            // --- Save Functionality ---
            function toggleSaveDestination(id, buttonElement) {
                initAudio(); // Ensure audio context is active
                if (savedDestinations[id]) {
                    delete savedDestinations[id];
                    // Play unsave sound (optional - could use a different sound)
                    playSound(saveSoundBuffer); // Reuse for simplicity
                } else {
                    savedDestinations[id] = true;
                    playSound(saveSoundBuffer);
                }
                localStorage.setItem('savedCosmicDestinations', JSON.stringify(savedDestinations));
                updateSaveButtonState(buttonElement, id);
            }

            function updateSaveButtonState(buttonElement, id) {
                if (!buttonElement) return;
                const icon = buttonElement.querySelector('i');
                const destName = destinations.find(d=>d.id===id)?.name || 'Destination'; // Fallback name
                if (savedDestinations[id]) {
                    buttonElement.classList.add('saved');
                    buttonElement.setAttribute('aria-label', `Unsave ${destName}`);
                    icon.classList.remove('far'); // Regular heart
                    icon.classList.add('fas');   // Solid heart
                } else {
                    buttonElement.classList.remove('saved');
                    buttonElement.setAttribute('aria-label', `Save ${destName}`);
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                }
            }


             // --- Parallax Effect ---
             function handleMouseMove(event) {
                if (isMobile) return; // Disable on mobile

                 const { clientX, clientY } = event;
                 const { innerWidth, innerHeight } = window;

                 // Calculate mouse position relative to center (-1 to 1)
                 const mouseX = (clientX / innerWidth) * 2 - 1;
                 const mouseY = -(clientY / innerHeight) * 2 + 1; // Inverted Y

                 // Apply tilt to container
                 const tiltX = mouseY * 6; // Max tilt degrees
                 const tiltY = mouseX * 8;
                 if(container) container.style.transform = `rotateX(${tiltX}deg) rotateY(${tiltY}deg) scale(1)`;

                 // Parallax for card content (only on the center card)
                 const centerItem = items.find(item => item.classList.contains('is-center'));
                 if (centerItem) {
                     const content = centerItem.querySelector('.content');
                     const name = content?.querySelector('.name'); // Optional chaining
                     const des = content?.querySelector('.des');
                     const buttons = content?.querySelector('.button-group');
                     const stats = content?.querySelector('.info-stats');

                     const contentOffsetX = mouseX * 15; // Max pixel offset
                     const contentOffsetY = mouseY * 10;
                      const nameOffsetX = mouseX * 8;
                      const nameOffsetY = mouseY * 5;
                      const desOffsetX = mouseX * 12;
                      const desOffsetY = mouseY * 8;
                      const buttonsOffsetX = mouseX * 18;
                      const buttonsOffsetY = mouseY * 12;
                      const statsOffsetX = mouseX * 10;
                      const statsOffsetY = mouseY * 6;


                     // Apply transform with base translateZ from CSS included
                     if(content) content.style.transform = `translateY(0) translateZ(30px) translateX(${contentOffsetX}px) translateY(${contentOffsetY}px)`;
                     if(name) name.style.transform = `translateX(${nameOffsetX}px) translateY(${nameOffsetY}px)`;
                     if(des) des.style.transform = `translateX(${desOffsetX}px) translateY(${desOffsetY}px)`;
                      if(buttons) buttons.style.transform = `translateX(${buttonsOffsetX}px) translateY(${buttonsOffsetY}px)`;
                      if(stats) stats.style.transform = `translateZ(20px) translateX(${statsOffsetX}px) translateY(${statsOffsetY}px)`;
                 }
             }
             function handleMouseLeave() {
                  if (isMobile || !container) return;
                 // Reset container tilt
                  container.style.transform = `rotateX(5deg) rotateY(0deg) scale(1)`; // Reset to initial tilt

                 // Reset content parallax on the center card
                 const centerItem = items.find(item => item.classList.contains('is-center'));
                  if (centerItem) {
                     const content = centerItem.querySelector('.content');
                     const name = content?.querySelector('.name'); // Optional chaining
                     const des = content?.querySelector('.des');
                     const buttons = content?.querySelector('.button-group');
                     const stats = content?.querySelector('.info-stats');

                     if(content) content.style.transform = 'translateY(0) translateZ(30px)'; // Reset to CSS base
                     if(name) name.style.transform = 'none';
                     if(des) des.style.transform = 'none';
                     if(buttons) buttons.style.transform = 'none';
                     if(stats) stats.style.transform = 'translateZ(20px)'; // Reset to CSS base
                  }
             }

            // --- Modal Functionality (Updated) ---
            let currentModalDestination = null; // Keep track of which destination is shown

            function showModal(destination) {
                 currentModalDestination = destination; // Store the current destination

                if (!modal || !modalContent || !modalTitle || !modalOverlay) {
                    console.error("Modal elements not found!");
                    return;
                }

                 // Warp Effect
                 if(modalOverlay) modalOverlay.classList.add('warping');
                 modalOverlay.onanimationend = () => {
                    if(modalOverlay) modalOverlay.classList.remove('warping');
                     modalOverlay.onanimationend = null; // Clean up listener
                 };

                // Update Modal Title Dynamically
                 modalTitle.textContent = `Explore: ${destination.name}`;

                 // Clear previous content
                 modalContent.innerHTML = '';

                // Inject the specific HTML content for this destination
                if (destination.exploreHTML) {
                    modalContent.innerHTML = destination.exploreHTML;
                     // Optional: Re-attach event listeners if needed for dynamically added content
                     // e.g., if the details/summary needed JS interaction beyond default browser behavior
                } else {
                     modalContent.innerHTML = '<p>Details coming soon for this destination.</p>'; // Fallback
                }


                 modal.classList.add('visible');
                 document.body.style.overflow = 'hidden'; // Prevent background scroll
             }

            function hideModal() {
                if (!modal || !modalContent) return;

                // Clear the dynamic content when closing
                modalContent.innerHTML = '';

                modal.classList.remove('visible');
                document.body.style.overflow = ''; // Restore scroll

                // Reset tracking variable
                 currentModalDestination = null;
            }


            // --- Initialization ---
            function initialize() {
                 // --- Fetch APOD ---
                 fetch(APOD_API_URL)
                    .then(response => {
                         if (!response.ok) {
                             throw new Error(`HTTP error! status: ${response.status}`);
                         }
                         return response.json();
                     })
                    .then(data => {
                        if (data.url && apodOverlay) {
                            // Preload image
                            const img = new Image();
                            img.onload = () => {
                                apodOverlay.style.backgroundImage = `url(${data.hdurl || data.url})`;
                                apodOverlay.classList.add('visible');
                            };
                            img.onerror = () => { // Handle image load error
                                console.error("Failed to load APOD image:", data.hdurl || data.url);
                                // Optionally try the non-HD URL if HD failed
                                if (data.hdurl && data.url !== data.hdurl) {
                                     console.log("Trying non-HD APOD URL...");
                                     img.src = data.url;
                                } else {
                                     apodOverlay.style.backgroundImage = 'none'; // Clear background on final failure
                                }
                            };
                            img.src = data.hdurl || data.url; // Prefer HD if available
                        } else {
                             console.warn("APOD data or URL missing:", data);
                        }
                    })
                    .catch(error => console.error('Error fetching or processing APOD:', error));

                // --- Create UI Elements ---
                if (slideContainer && paginationContainer) {
                    slideContainer.innerHTML = ''; // Clear existing
                    paginationContainer.innerHTML = '';
                    items = []; // Reset items array
                    backgroundItems = []; // Reset background items array
                    dots = []; // Reset dots array


                    // Create background items (two for crossfade)
                     if (destinations.length > 0) {
                         // Ensure there's at least one destination for the preview background
                         const previewIndex = destinations.length > 1 ? 1 : 0;
                        backgroundItems.push(createBackgroundItem(destinations[0].images[0], 0)); // Main
                        backgroundItems.push(createBackgroundItem(destinations[previewIndex].images[0], previewIndex)); // Preview
                        backgroundItems[0].classList.add('main-display');
                        backgroundItems[1].classList.add('background-preview');
                        slideContainer.appendChild(backgroundItems[0]);
                        slideContainer.appendChild(backgroundItems[1]);
                     }

                    // Create destination card items and pagination dots
                    destinations.forEach((dest, index) => {
                        const item = createItem(dest, index);
                        items.push(item);
                        slideContainer.appendChild(item);

                        const dot = createPaginationDot(index);
                        dots.push(dot);
                        paginationContainer.appendChild(dot);
                    });
                } else {
                     console.error("Slide container or pagination container not found!");
                     // Hide preloader even if setup fails partially
                     if(preloader) preloader.classList.add('hidden');
                     return; // Stop initialization if containers missing
                }

                 createParticles();

                 // --- Set Initial State ---
                 updateSlide(0, true); // Initial setup, no transition sounds/delays

                // --- Add Event Listeners ---
                if(prevBtn) prevBtn.addEventListener('click', () => { initAudio(); playSound(navigateSoundBuffer); updateSlide(currentIndex - 1); });
                if(nextBtn) nextBtn.addEventListener('click', () => { initAudio(); playSound(navigateSoundBuffer); updateSlide(currentIndex + 1); });
                if(closeModalBtn) closeModalBtn.addEventListener('click', hideModal);
                if(modal) modal.addEventListener('click', (e) => { if (e.target === modal) hideModal(); }); // Close on overlay click
                document.addEventListener('keydown', (e) => {
                    if (modal && modal.classList.contains('visible')) { // Check if modal exists and is visible
                        if (e.key === 'Escape') hideModal();
                    } else {
                         // Prevent slide navigation if focus is on an input/button/link etc.
                         const activeElementTag = document.activeElement?.tagName?.toUpperCase();
                         const canNavigate = !activeElementTag || !['INPUT', 'TEXTAREA', 'SELECT', 'BUTTON', 'A'].includes(activeElementTag);

                        if (canNavigate) {
                            if (e.key === 'ArrowLeft') { if(prevBtn) { initAudio(); playSound(navigateSoundBuffer); updateSlide(currentIndex - 1); } }
                            else if (e.key === 'ArrowRight') { if(nextBtn) { initAudio(); playSound(navigateSoundBuffer); updateSlide(currentIndex + 1); } }
                        }
                    }
                });


                 // Add Parallax listeners
                if (window.innerWidth > MOBILE_BREAKPOINT) { // Only add parallax for non-mobile
                     document.addEventListener('mousemove', handleMouseMove);
                     if(container) container.addEventListener('mouseleave', handleMouseLeave);
                 }
                 window.addEventListener('resize', () => {
                     const wasMobile = isMobile;
                     isMobile = window.innerWidth <= MOBILE_BREAKPOINT;
                     if (wasMobile && !isMobile) { // Transitioned to desktop
                         document.addEventListener('mousemove', handleMouseMove);
                         if(container) container.addEventListener('mouseleave', handleMouseLeave);
                     } else if (!wasMobile && isMobile) { // Transitioned to mobile
                         document.removeEventListener('mousemove', handleMouseMove);
                          if(container) container.removeEventListener('mouseleave', handleMouseLeave);
                          handleMouseLeave(); // Reset transforms if switching to mobile
                     }
                     // Recreate particles on resize might be too heavy, consider adjusting existing ones if needed
                     // createParticles(); // Optional: uncomment if particle density needs adjustment on resize
                 });

                 // --- Hide Preloader ---
                 // Use setTimeout to ensure rendering has a chance before hiding
                 setTimeout(() => {
                    if(preloader) preloader.classList.add('hidden');
                 }, 50); // Small delay


                // --- Audio Interaction Initialization ---
                const initAudioInteraction = () => {
                    initAudio();
                    // Clean up listeners after first interaction
                    document.body.removeEventListener('click', initAudioInteraction);
                    document.body.removeEventListener('keydown', initAudioInteraction);
                };
                // Use capture phase for broader initial interaction detection
                document.body.addEventListener('click', initAudioInteraction, { once: true, capture: true });
                document.body.addEventListener('keydown', initAudioInteraction, { once: true, capture: true });


           } // End initialize function

            // Start initialization
            setupAudio().then(initialize).catch(err => {
                console.error("Initialization failed:", err);
                 // Hide preloader even if initialization fails
                 const preloader = document.getElementById('preloader');
                 if(preloader) preloader.classList.add('hidden');
            });


        }); // End DOMContentLoaded
    </script>
</body>
</html>